{
  "id": "sec-TmlplXlhpu2gAP4_iKrgd",
  "title": "Reference Implementation",
  "defs": [],
  "content": [
    {
      "type": "paragraph",
      "text": "Reference implementation schemas defined using Zod for runtime type validation."
    },
    {
      "type": "admonition",
      "level": "warning",
      "text": "**Known Issue - Schema Drift [v2.4.4]**: The Zod schemas below represent an earlier version (v1.0) and have NOT been updated to reflect v2.0+ additions. Known discrepancies:\n\n**Metadata**: Formal spec (¬ß2.1) includes `version: VersionVector, actor: ACTOR, clock: CLOCK` (v2.0); Zod has `version: string`, missing actor/clock.\n\n**Dependency** (¬ß2.3): Formal spec includes `cascade_boundary: ùîπ` (v2.0); Zod schema missing this field.\n\n**Constraint** (¬ß2.4): Formal spec includes `priority: ‚Ñï` for conflict resolution (v2.0); Zod schema missing priority.\n\n**Completeness enum**: Formal spec uses `{complete, partial, stub}`; Zod uses `{full, partial, stub}` (naming inconsistency).\n\n**Change types**: Formal spec (¬ß4.5) has `{create, update, delete, deprecate}`; Zod has `{create, modify, delete, rename}` (semantic drift: update‚â†modify, deprecate‚â†rename).\n\n**Impact severity**: Formal spec uses `{‚ä•, cosmetic, degraded, breaking}` (‚ä• = bottom/none); Zod uses `{none, cosmetic, degraded, breaking}` (need explicit ‚ä•‚Üînone equivalence).\n\n**Recommendation**: These schemas should be considered **Tier 3 conformance** (partial implementation) pending full v2.0+ synchronization. For certification purposes, use the formal definitions in ¬ß2-6 as normative."
    },
    {
      "type": "code",
      "language": "typescript",
      "lines": [
        "export const TierSchema = z.enum(['motivation', 'logical', 'realization', 'grounding']);",
        "",
        "export const StatusSchema = z.enum(['draft', 'active', 'deprecated', 'archived']);",
        "",
        "export const MetadataSchema = z.object({",
        "  created: z.string().datetime(),",
        "  updated: z.string().datetime(),",
        "  version: z.string(),",
        "  status: StatusSchema,",
        "});",
        "",
        "export const ElementSchema = z.object({",
        "  id: z.string(),",
        "  type: z.string(),",
        "  layer: z.string(),",
        "  properties: z.record(z.string(), z.any()),",
        "  metadata: MetadataSchema,",
        "});",
        "",
        "export const LayerSchema = z.object({",
        "  id: z.string(),",
        "  name: z.string(),",
        "  tier: TierSchema,",
        "  order: z.number().int().nonnegative(),",
        "  answersQuestion: z.string(),",
        "  elementTypes: z.array(z.string()),",
        "  dependencies: z.array(z.string()),",
        "});",
        "",
        "export const DepTypeSchema = z.enum([",
        "  'realizes', 'requires', 'produces', 'consumes',",
        "  'constrains', 'validates', 'traces_to',",
        "]);",
        "",
        "export const StrengthSchema = z.enum(['hard', 'soft']);",
        "",
        "export const CardinalitySchema = z.enum([",
        "  'one_to_one', 'one_to_many', 'many_to_one', 'many_to_many',",
        "]);",
        "",
        "export const DependencySchema = z.object({",
        "  id: z.string(),",
        "  source: z.object({ elementId: z.string(), layerId: z.string() }),",
        "  target: z.object({ elementId: z.string(), layerId: z.string() }),",
        "  type: DepTypeSchema,",
        "  strength: StrengthSchema,",
        "  cardinality: CardinalitySchema,",
        "});",
        "",
        "export const CategorySchema = z.enum([",
        "  'existence', 'uniqueness', 'completeness', 'consistency',",
        "  'validity', 'dependency', 'ordering', 'coverage', 'alignment', 'boundary',",
        "]);",
        "",
        "export const SeveritySchema = z.enum(['error', 'warning', 'info']);",
        "",
        "export const ConstraintSchema = z.object({",
        "  id: z.string(),",
        "  name: z.string(),",
        "  scope: z.object({",
        "    sourceLayer: z.string().optional(),",
        "    sourceType: z.string().optional(),",
        "    targetLayer: z.string().optional(),",
        "    targetType: z.string().optional(),",
        "  }),",
        "  category: CategorySchema,",
        "  severity: SeveritySchema,",
        "  predicate: z.string(),",
        "  message: z.string(),",
        "});",
        "",
        "export const CompletenessSchema = z.enum(['full', 'partial', 'stub']);",
        "",
        "export const ArtifactSchema = z.object({",
        "  type: z.string(),",
        "  location: z.string(),",
        "  identifier: z.string(),",
        "  properties: z.record(z.string(), z.any()).optional(),",
        "});",
        "",
        "export const BindingSchema = z.object({",
        "  id: z.string(),",
        "  abstract: z.object({ elementId: z.string(), layerId: z.string() }),",
        "  concrete: ArtifactSchema,",
        "  completeness: CompletenessSchema,",
        "  verification: z.object({",
        "    lastVerified: z.string().datetime().optional(),",
        "    method: z.string().optional(),",
        "  }).optional(),",
        "});",
        "",
        "export const ChangeTypeSchema = z.enum(['create', 'modify', 'delete', 'rename']);",
        "",
        "// IMPACT = {‚ä•, cosmetic, degraded, breaking} per Definition 2.25",
        "// Note: '‚ä•' is represented as 'bottom' in JSON/TypeScript for compatibility",
        "export const EffectSeveritySchema = z.enum(['breaking', 'degraded', 'cosmetic', 'bottom']);",
        "",
        "export const DirectionSchema = z.enum(['forward', 'backward', 'both']);",
        "",
        "export const CascadeRuleSchema = z.object({",
        "  id: z.string(),",
        "  trigger: z.object({",
        "    elementType: z.string(),",
        "    changeType: ChangeTypeSchema,",
        "  }),",
        "  propagation: z.object({",
        "    dependencyTypes: z.array(DepTypeSchema),",
        "    direction: DirectionSchema,",
        "    maxDepth: z.number().int().positive().optional(),",
        "  }),",
        "  effect: z.object({",
        "    severity: EffectSeveritySchema,",
        "    action: z.string(),",
        "    attenuates: z.boolean(),",
        "  }),",
        "});",
        "",
        "export const SpecificationSchema = z.object({",
        "  id: z.string(),",
        "  name: z.string(),",
        "  domain: z.string(),",
        "  version: z.string(),",
        "  layers: z.array(LayerSchema),",
        "  elements: z.array(ElementSchema),",
        "  dependencies: z.array(DependencySchema),",
        "  constraints: z.array(ConstraintSchema),",
        "  bindings: z.array(BindingSchema),",
        "  cascadeRules: z.array(CascadeRuleSchema),",
        "  metadata: MetadataSchema,",
        "});"
      ]
    }
  ]
}
